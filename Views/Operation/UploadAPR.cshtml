@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (TempData["SucessAPR"] != null)
{
    <div class="alert alert-primary" id="NotificationDiv" role="alert">
        <span class="fe fe-alert-circle fe-16 mr-2">
            @TempData["SucessAPR"]
        </span>
    </div>
}

@using (Html.BeginForm("UploadAPRDEtails", "Operation", FormMethod.Post, new { enctype = "multipart/form-data" }))

{
    <div class="row">
        <!-- First Column -->
        <div class="form-group col-md-6">
            <label for="ProgramID">Select Program</label> <span style="color:red">*</span>
            @Html.DropDownList("ProgramID", (List<SelectListItem>)ViewBag.Process, "Select Program", new { @class = "custom-select", id = "ProgramID", onchange = "onProgramChange()", required = "required" })
        </div>
        <div class="form-group col-md-6">
            <label for="SUBProgramID">Sub Program Name</label> <span style="color:red">*</span>
            <select name="SUBProgramID" id="SUBProgramID" class="custom-select" onchange="onSubProgramChange()" required>
            </select>
        </div>

        <div class="col-md-6">
           
            <div class="form-group mb-3">


            </div>
            <div class="form-group mb-3">
                <label for="fileUpload">Upload APR List</label>  <small class="form-text text-muted">
                    <span style="color:red">*</span>
               
                    <a href="/SampleFile/APRNEW.xls" download>Download Sample File</a>
                </small>
                <input type="file" id="files" name="files" class="form-control" required />
            </div>
        </div>
    </div>

  
    <div class="col-md-2 my-4">
        <div class="card-body d-flex justify-content-center align-items-center">
            <button type="submit" class="btn btn-primary">Create</button>
        </div>
    </div>
}

                    <script>

                        async function onProgramChange() {
        const programId = $('#ProgramID').val();
        if (programId === "") {
            alert("Please Select Program first");
            return;
        }

        try {
            const response = await fetch("/Admin/GetSUBProcessList", {
                method: "POST",
                headers: { "Content-Type": "application/json; charset=utf-8" },
                body: JSON.stringify({ id: programId })
            });
            const data = await response.json();

            const dropdown = $('#SUBProgramID');
            dropdown.empty();
            dropdown.append('<option value="">Select Sub Process</option>');

            data.proces.forEach(function (item) {
                dropdown.append('<option value="' + item.value + '">' + item.text.split(',')[0] + '</option>');
            });
        } catch (error) {
            console.error("Error occurred:", error);
        }
    }
                    </script>