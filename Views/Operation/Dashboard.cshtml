@model OperationViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    var now = DateTime.Now;
}
<div class="card shadow mb-4">
    <div class="card-header" style="cursor: pointer;" data-toggle="collapse" data-target="#ztCaseTable" aria-expanded="false" aria-controls="ztCaseTable">
        <strong class="card-title">Pending ZT Case View</strong>
    </div>

    <div id="ztCaseTable" class="collapse">
        <div class="card-body">
            <div style="overflow-x: auto;">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ProgramIDrrrr</th>
                            <th>SubProgramID</th>
                            <th>AgentName</th>
                            <th>EmployeeID</th>
                            <th>AgentSupervsor</th>
                            <th>ZTRaisedBy</th>
                            <th>ZTRaisedDate</th>
                            <th>TransactionDate</th>
                            <th>ZTClassification</th>
                            <th>TransactionID</th>
                            <th>View</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.ZTcaseList != null && Model.ZTcaseList.Any())
                        {
                            @foreach (var item in Model.ZTcaseList)
                            {
                                <tr>
                                    <td>@item.ProgramID</td>
                                    <td>@item.SubProgramID</td>
                                    <td>@item.AgentName</td>
                                    <td>@item.EmployeeID</td>
                                    <td>@item.AgentSupervsor</td>
                                    <td>@item.ZTRaisedBy</td>
                                    <td>@item.ZTRaisedDate</td>
                                    <td>@item.TransactionDate</td>
                                    <td>@item.ZTClassification</td>
                                    <td>@item.TransactionID</td>
                                    <td>
                                        <a href="/Operation/OperationZtCase?TransactionID=@item.TransactionID" class="btn btn-primary btn-sm">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="11" class="text-center">No pending Zt Cases.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header" style="cursor: pointer;" data-toggle="collapse" data-target="#ASS" aria-expanded="false" aria-controls="ASS">
        <strong class="card-title"> Online assessment</strong>
    </div>
    <div class="card-body collapse" id="ASS">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Test Name</th>
                    <th>Test Category</th>
                    <th>Date</th>
                    <th>View</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.assmentonl != null && Model.assmentonl.Any())
                {
                    foreach (var item in Model.assmentonl)
                    {
                        bool isExpired = false;

                        if (item.expiryType == "date")
                        {
                            if (item.expiryDate < now)
                            {
                                isExpired = true;
                            }
                        }
                        else if (item.expiryType == "hours")
                        {
                            var expiryDateTime = item.CreatedDate.AddHours(item.expiryHours);
                            if (expiryDateTime < now)
                            {
                                isExpired = true;
                            }
                        }

                        var rowClass = isExpired ? "table-danger" : "";

                        <tr class="@rowClass">
                            <td>@item.TestName</td>
                            <td>@item.TestCategory</td>
                            <td>@item.CreatedDate</td>
                            <td>
                                <a href="/QAManager/AttempAssesment?TestID=@item.TestID" class="btn btn-primary btn-sm">
                                    View
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center">No pending feedback.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="card shadow mb-4">
 
    <div class="card-header" style="cursor: pointer;" data-toggle="collapse" data-target="#Calibration" aria-expanded="false" aria-controls="Calibration">
        <strong class="card-title">Calibration Pending</strong>
    </div>
    <div class="card-body collapse" id="Calibration">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>TransactionID</th>
                    <th>Assigned_By</th>
     
                    <th>Assigned_Date</th>
                    
                    <th>View</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Calibration != null && Model.Calibration.Any())
                {
                    @foreach (var item in Model.Calibration)
                    {
                        <tr>
                            <td>@item.TransactionID</td>
                            <td>@item.Assigned_By</td>
                            <td>@item.Assigned_Date</td>
                           

                            <td>
                                <a href="/Operation/Participants_Calibration_View?TransactionID=@item.TransactionID&Process=@item.ProgramID&subProcess=@item.SubProgramID" class="btn btn-primary btn-sm">
                                    View
                                </a>
                               
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center">No pending Zt Cases.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>


</div>



