@model List<AgentfeedbackSectionModel> 

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card shadow mb-4">
    <div class="card-header">
        <strong class="card-title">Section</strong>
    </div>
    <div class="card-body">
        <table id="sectionGrid" class="table table-bordered">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Level</th>
                    <th>Section Name</th>
                    <th>QA Rating</th>
                    <th>Scorable</th>
                    <th>Weightage</th>
                    <th>Fatal</th>
                    <th>Comments Section</th>
               
                    
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.category</td>
                            <td>@item.level</td>
                            <td>@item.Section</td>
                            <td>@item.QA_rating</td>
                            <td>@item.Scorable</td>
                            <td>@item.Weightage</td>
                            <td>@item.Fatal</td>
                            <td>@item.Commentssection</td>
                          
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="text-center">No feedback sections available.</td>
                    </tr>
                }
                <tr>
                    <td colspan="5" class="text-right font-weight-bold">CQ Scores:</td>
                    <td id="totalScore" class="font-weight-bold">@ViewBag.cqscore</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="col-md-12 my-4" id="AuditDiv">
    <div class="card shadow" style="border-radius: 10px; border: 1px solid #ddd;">
        <div class="card-body" style="padding: 20px;">
            <h5 class="card-title" style="font-weight: bold; color: #eaebf1;">Feedback Acknowledgement</h5>
            <div class="row" style="margin-top: 15px;">
                <div class="form-group col-md-12">
                    <label for="QAComments" style="font-weight: 600; color: #eaebf1; font-size: 16px; display: block; margin-bottom: 8px;">
                        Voice Feedback
                    </label>

                    <div style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; background-color: #2a2c4a; text-align: center;">
                        @if (!string.IsNullOrEmpty(ViewBag.AudioData))
                        {
                            <audio controls style="width: 100%; max-width: 400px;">
                                <source src="@ViewBag.AudioData" type="audio/wav">
                                Your browser does not support the audio element.
                            </audio>
                        }
                        else
                        {
                            <p style="color: #777; font-style: italic;">No audio available.</p>
                        }
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-12">
                    <label for="QAComments" style="font-weight: 600; color: white;">QA Comments</label>
                    <input type="text" value="@ViewBag.QA_Comments" readonly
                           style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; background-color: #2a2c4a; color:white;">
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-12">
                    <label for="AgentComent" style="font-weight: 600; color: white;">Agent Comments</label> <span style="color:red">*</span>
                    <input type="text" id="AgentComent" placeholder="Enter your comments" required
                           style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;background-color: #2a2c4a;  color: white;">
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-2">
                    <button type="submit" onclick="submitAgentComment()"
                            style="background-color: #24294a; color: #fff; padding: 10px 15px; border: solid 1px white; border-radius: 5px; font-weight: 600; cursor: pointer;">
                        Acknowledge
                    </button>
                </div>
                <div class="form-group col-md-2">
                    <button type="submit" onclick="submitFeedbackDispute()"
                            style="background-color: #24294a; color: #fff; padding: 10px 15px; border: solid 1px white; border-radius: 5px; font-weight: 600; cursor: pointer;">
                        Dispute
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>




    <script>
        function submitAgentComment() {
            var agentComment = $("#AgentComent").val(); // Get the input value

            if (agentComment.trim() === "") {
                alert("Please enter a comment before acknowledging.");
                return;
            }

            $.ajax({
                url: '/Agent/SubmitFeedback', 
                type: 'POST',
                data: { comment: agentComment },
                success: function (response) {
                    alert(response.message);
                    $("#AgentComent").val(""); 
                         if (response.success) {
                        window.location.href = '/Agent/Dashboard'; 
                    }
                },
                error: function () {
                    alert("Error submitting the comment.");
                }
            });
        }
     function submitFeedbackDispute() {
        var agentComment = $("#AgentComent").val(); // Get the input value

        if (agentComment.trim() === "") {
            alert("Please enter a comment before acknowledging.");
            return;
        }

        $.ajax({
            url: '/Agent/DisputeFeedback',
            type: 'POST',
            data: { comment: agentComment },
            success: function (response) {
                alert(response.message);
                $("#AgentComent").val("");
                     if (response.success) {
                    window.location.href = '/Agent/Dashboard';
                }
            },
            error: function () {
                alert("Error submitting the comment.");
            }
        });
    }
</script>

