@model System.Data.DataTable;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    var locations = ViewBag.Locations as List<SelectListItem>;
    var roles = ViewBag.Roles as List<SelectListItem>;
}


<div class="col-md-12 my-4">
    <div class="card shadow">
        <div class="card-body">
            <h5 class="card-title">Welcome </h5>
            <div class="alert alert-primary" id="NotificationDiv" runat="server" role="alert">
                <span class="fe fe-alert-circle fe-16 mr-2" id="Notif   ication" runat="server"></span>

            </div>

            <table id="SuperAdminTable" class="table table-bordered table-hover mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>UserName</th>
                        <th>Role</th>
                        <th>Process</th>
                        <th>Location</th>
                        <th>Active_Status</th>
                        <th>Created_Date</th>
                        <th>Activate</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (System.Data.DataRow row in Model.Rows)
                    {
                        <tr>
                            <td>@row["ID"]</td>
                            <td>@row["username"]</td>
                            <td>@row["Role"]</td>
                            <td>@row["Process"]</td>
                            <td>@row["Location"]</td>
                            <td>@(row["Active_Status"].ToString() == "1" ? "Yes" : "No")</td>
                            <td>@row["Created_Date"]</td>
                            <td>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="chk_@row["ID"]"
                                    @(row["Active_Status"].ToString() == "1" ? "checked" : "")
                                           onclick="updateStatus('@row["ID"]', this.checked)" />
                                    <label class="custom-control-label" for="chk_@row["ID"]"></label>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            
        </div>
    </div>
</div>


<div class="col-md-12 my-4">
    <div class="card shadow">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-2">
                        <label for="LocationDropDown">Location Name</label>
                        @Html.DropDownList("Location_ID", (List<SelectListItem>)ViewBag.Locations, "Select Location", new { @class = "custom-select", id = "Location_ID", onchange = "onLocationChange()" })
                    </div>
                    </div>

                    <div class="form-group mb-2">
                        <label for="drpSubProgram"> Program Name</label>
                    <select id="ProgramID" class="custom-select" onchange="onProgramChange()">
                        <option value="">Select Process</option>
                    </select>

                    </div>

                    <div class="form-group mb-2">
                        <label for="txtPassword">Password</label>
                       
                    </div>

                    <div class="form-group mb-2">
                        <label for="UserName">User Name</label>
                      
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-2">
                        <label for="ProgramDropDown"> Sub Program Name</label>

                    <select id="SUBProgramID" class="custom-select" onchange="onProgramChange()">
                        <option value="">Select Process</option>
                    </select>

                    </div>

                    <div class="form-group mb-2">
                        <label for="txtUsername">User ID</label>
                        
                    </div>

                    <div class="form-group mb-2">
                        <label for="drpRole">Role Name</label>
                   
                    </div>

                    <div class="form-group mb-2">
                        <label for="Phone">Phone Number</label>
                       
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-2 my-4">
    <div class="card-body d-flex justify-content-center align-items-center">
        <button type="submit" class="btn btn-primary">Create User*</button>
    </div>
</div>

<script>
    function onLocationChange() {

        var Location = $('#Location_ID').val();
        
        $.ajax({
            type: "POST",
            data: JSON.stringify({ id: Location }),

            url: "/Admin/GetProcessList",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {

                var dropdown = $('#ProgramID');
                dropdown.empty(); 
                dropdown.append('<option value="">Select Process</option>');
                response.proces.forEach(function (item) {
                    dropdown.append('<option value="' + item.value + '">' + item.text + '</option>');
                });
            },
            error: function (xhr, status, error) {
                console.error("Error occurred: " + error);
            }
        });
    }
    function onProgramChange() {
        var programId = document.getElementById("ProgramID").value;
        $.ajax({
            type: "POST",
            data: JSON.stringify({ id: programId }),

            url: "/Admin/GetSUBProcessList",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {

                var dropdown = $('#SUBProgramID');
                dropdown.empty();
                dropdown.append('<option value="">Select Process</option>');
                response.proces.forEach(function (item) {
                    dropdown.append('<option value="' + item.value + '">' + item.text + '</option>');
                });
            },
            error: function (xhr, status, error) {
                console.error("Error occurred: " + error);
            }
        });
        
    }

    function updateStatus(id, isActive) {
        
       
        $.ajax({
            type: "POST",
            url: "/Admin/ActiveDeActiveUser",
            data: JSON.stringify({ id: id, isActive: isActive }),
            contentType: "application/json; charset=utf-8", 
            dataType: "json",
            success: function (response) {
                location.reload;
                console.log("Update successful: " + response.d); 
            },
            error: function (xhr, status, error) {
                console.error("Error occurred: " + error);
            }
        });
    }
</script>